<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Luxury Auction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="signalr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body {
            background-color: #050505;
            color: #ffffff;
            font-family: 'Outfit', sans-serif;
            background-image:
                radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%),
                radial-gradient(at 50% 0%, hsla(225,39%,30%,1) 0, transparent 50%),
                radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 24px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
        }
        .product-img {
            width: 100%;
            height: 350px;
            object-fit: cover;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            transition: transform 0.4s ease;
        }
        .product-img:hover { transform: scale(1.01); }
        .price-tag {
            font-size: 3.5rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
            letter-spacing: -2px;
            transition: all 0.3s ease;
        }
        .price-pop { transform: scale(1.1); color: #00ff88 !important; }
        .bid-list { max-height: 400px; overflow-y: auto; padding-right: 5px; }
        .bid-item {
            background: linear-gradient(90deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 100%);
            margin-bottom: 12px;
            border-radius: 12px;
            padding: 12px 15px;
            border-left: 4px solid #00ff88;
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes slideIn { from { transform: translateX(-30px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .live-badge { animation: pulse-red 2s infinite; }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        .custom-select {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 8px 15px;
            outline: none;
            cursor: pointer;
            transition: all 0.3s;
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white' width='18px' height='18px'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 10px center;
            padding-right: 35px;
        }
        .custom-select option { background-color: #1a1a1a; }
        .countdown-box {
            background: rgba(255, 255, 255, 0.05);
            padding: 8px 15px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            color: #ffcc00;
        }
        .bid-input {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            width: 100%;
        }
        .bid-input:focus { outline: none; border-color: #00ff88; box-shadow: 0 0 10px rgba(0, 255, 136, 0.2); }
        .action-btn {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            border: none;
            color: white;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 10px;
            width: 100%;
            transition: 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .action-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4); }
        .quick-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.1);
            color: #ddd;
            border-radius: 8px;
            font-size: 0.8rem;
            transition: 0.2s;
        }
        .quick-btn:hover { background: rgba(255,255,255,0.2); color: white; }

        /* --- BURAYA SATILDI EFEKTÄ°NÄ° EKLEDÄ°M --- */
        .sold-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(5px);
            border-radius: 24px;
        }
        .sold-text {
            font-size: 5rem;
            font-weight: 900;
            color: #ff3333;
            transform: rotate(-15deg);
            border: 8px solid #ff3333;
            padding: 20px 60px;
            text-transform: uppercase;
            letter-spacing: 10px;
            box-shadow: 0 0 50px rgba(255, 51, 51, 0.5);
            background: rgba(0,0,0,0.5);
            animation: stamp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes stamp {
            0% { opacity: 0; transform: scale(3) rotate(-15deg); }
            100% { opacity: 1; transform: scale(1) rotate(-15deg); }
        }
    </style>
</head>
<body>
    <audio id="bidSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_24e3933221.mp3"></audio>
    <audio id="winSound" src="https://cdn.pixabay.com/audio/2021/08/04/audio_0625c153e2.mp3"></audio>

    <nav class="navbar navbar-dark py-4">
        <div class="container d-flex justify-content-between">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <i class="fa-solid fa-gavel fa-lg me-3 text-white"></i>
                <div style="line-height: 1;">
                    <div class="fw-bold fs-4">NEXUS</div>
                    <div style="font-size: 0.7rem; letter-spacing: 3px; color: #00ff88;">AUCTION HOUSE</div>
                </div>
            </a>
            <div class="d-flex align-items-center gap-3">
                <select id="languageSelector" class="custom-select" onchange="changeLanguage(this.value)">
                    <option value="tr">ðŸ‡¹ðŸ‡· TÃ¼rkÃ§e</option>
                    <option value="en">ðŸ‡¬ðŸ‡§ English</option>
                    <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
                    <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                </select>
                <div class="d-flex align-items-center glass-card px-3 py-2">
                    <i class="fa-solid fa-circle me-2" id="connectionStatus" style="font-size: 10px; color: #666;"></i>
                    <span id="statusText" class="small fw-bold text-muted" data-i18n="connecting">BaÄŸlantÄ± Bekleniyor...</span>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4 pb-5">
        <div class="row g-4">
            <div class="col-lg-7">
                <div class="glass-card p-4 h-100 d-flex flex-column position-relative" id="productCard">
                    <div id="soldOverlay" class="d-none sold-overlay">
                        <div class="sold-text">SATILDI</div>
                    </div>
                    <div class="position-relative mb-3">
                        <span class="badge bg-danger position-absolute top-0 start-0 m-3 px-3 py-2 rounded-pill live-badge" id="liveBadge">
                            <i class="fa-solid fa-tower-broadcast me-1"></i> <span data-i18n="live">CANLI</span>
                        </span>
                        <img src="https://images.pexels.com/photos/6968984/pexels-photo-6968984.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1"
                             alt="Luxury Car" class="product-img">
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h2 class="fw-bold mb-0">Lamborghini Aventador SVJ</h2>
                        <div class="countdown-box" id="countdownTimer"><i class="fa-regular fa-clock me-2"></i>05:00:00</div>
                    </div>
                    <div class="d-flex gap-3 text-secondary mb-3 small">
                        <span><i class="fa-solid fa-gauge-high me-1"></i> 770 HP</span>
                        <span><i class="fa-solid fa-stopwatch me-1"></i> 0-100: 2.8s</span>
                        <span><i class="fa-solid fa-calendar me-1"></i> 2024</span>
                    </div>
                    <div class="p-3 rounded-4 mb-3" style="background: rgba(0,0,0,0.3);">
                        <div class="row align-items-end">
                            <div class="col">
                                <small class="text-secondary text-uppercase fw-bold letter-spacing-2" data-i18n="currentBid">GÃœNCEL TEKLÄ°F</small>
                                <div class="price-tag mt-1" id="currentPrice">--- $</div>
                            </div>
                            <div class="col-auto text-end">
                                <small class="text-secondary d-block mb-1" data-i18n="lastBidder">Son Teklif Veren</small>
                                <div class="d-flex align-items-center justify-content-end p-2 rounded-3" style="background: rgba(255,255,255,0.1);">
                                    <i class="fa-solid fa-crown text-warning me-2"></i>
                                    <span class="fw-bold text-white" id="leaderUser">---</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="glass-card p-3 mt-auto border-top border-secondary border-opacity-25" id="bidPanel">
                        <h5 class="fw-bold mb-3"><i class="fa-solid fa-money-bill-wave me-2 text-success"></i><span data-i18n="placeBidTitle">Teklif Ver</span></h5>
                        <input type="text" id="auctionIdInput" class="bid-input mb-2" placeholder="Auction ID (UUID)" style="font-size: 0.8rem; opacity: 0.7;">
                        <div class="row g-2 mb-2">
                            <div class="col-md-6">
                                <input type="text" id="userInput" class="bid-input" placeholder="KullanÄ±cÄ±" value="">
                            </div>
                            <div class="col-md-6">
                                <input type="number" id="bidAmountInput" class="bid-input" placeholder="Tutar">
                            </div>
                        </div>
                        <div class="d-flex gap-2 mb-3 overflow-auto pb-1">
                            <button class="quick-btn px-3 py-1" onclick="addQuickBid(1000)">+ $1.000</button>
                            <button class="quick-btn px-3 py-1" onclick="addQuickBid(5000)">+ $5.000</button>
                            <button class="quick-btn px-3 py-1" onclick="addQuickBid(10000)">+ $10.000</button>
                            <button class="quick-btn px-3 py-1" onclick="addQuickBid(50000)">+ $50.000</button>
                        </div>
                        <button onclick="submitBid()" class="action-btn" id="submitBtn">
                            <span data-i18n="bidButton">TEKLÄ°FÄ° GÃ–NDER</span> <i class="fa-solid fa-paper-plane ms-2"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-lg-5">
                <div class="glass-card p-4 h-100 d-flex flex-column">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="mb-0 fw-bold" data-i18n="liveFeed">CanlÄ± AkÄ±ÅŸ</h4>
                        <span class="badge bg-success bg-opacity-10 text-success px-3 py-2 rounded-pill">Real-Time</span>
                    </div>
                    <div id="activityFeed" class="bid-list flex-grow-1">
                        <div class="text-center text-muted mt-5 pt-5" id="waitingMessageContainer">
                            <i class="fa-solid fa-hourglass-start fs-1 mb-3 opacity-25"></i>
                            <p data-i18n="waitingMessage">MÃ¼zayede baÅŸladÄ±. Ä°lk teklif bekleniyor...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- GENEL AYARLARIM ---
        const API_BASE_URL = "https://localhost:7232";
        let currentDisplayedPrice = 0;
        let currentRealPrice = 0;

        // --- DÄ°L SEÃ‡ENEKLERÄ°NÄ° BURADA TANIMLADIM ---
        const translations = {
            tr: {
                connecting: "BaÄŸlantÄ± Bekleniyor...", connected: "CANLI BAÄžLANTI (Online)", error: "BaÄŸlantÄ± HatasÄ±",
                live: "CANLI", currentBid: "GÃœNCEL TEKLÄ°F", lastBidder: "Son Teklif Veren", liveFeed: "CanlÄ± AkÄ±ÅŸ",
                waitingMessage: "MÃ¼zayede baÅŸladÄ±. Ä°lk teklif bekleniyor...", bidAction: "Teklif verdi",
                signalRError: "SignalR DosyasÄ± BulunamadÄ±!", placeBidTitle: "Teklif Ver", bidButton: "TEKLÄ°FÄ° GÃ–NDER",
                successTitle: "BaÅŸarÄ±lÄ±!", successMsg: "Teklifiniz iletildi.", errorTitle: "Hata!",
                lowBidMsg: "Teklifiniz mevcut fiyattan yÃ¼ksek olmalÄ±!", sold: "SATILDI", ended: "SONA ERDÄ°"
            },
            en: {
                connecting: "Waiting for connection...", connected: "LIVE CONNECTION (Online)", error: "Connection Error",
                live: "LIVE", currentBid: "CURRENT BID", lastBidder: "Last Bidder", liveFeed: "Live Feed",
                waitingMessage: "Auction started. Waiting for the first bid...", bidAction: "placed a bid",
                signalRError: "SignalR File Not Found!", placeBidTitle: "Place A Bid", bidButton: "SUBMIT BID",
                successTitle: "Success!", successMsg: "Your bid has been placed.", errorTitle: "Error!",
                lowBidMsg: "Your bid must be higher than current price!", sold: "SOLD", ended: "ENDED"
            },
            de: {
                connecting: "Verbindung wird hergestellt...", connected: "LIVE VERBINDUNG (Online)", error: "Verbindungsfehler",
                live: "LIVE", currentBid: "AKTUELLES GEBOT", lastBidder: "Letzter Bieter", liveFeed: "Live-Feed",
                waitingMessage: "Warten auf das erste Gebot...", bidAction: "hat geboten",
                signalRError: "SignalR fehlt!", placeBidTitle: "Gebot Abgeben", bidButton: "GEBOT SENDEN",
                successTitle: "Erfolg!", successMsg: "Gebot platziert.", errorTitle: "Fehler!",
                lowBidMsg: "Gebot muss hÃ¶her sein!", sold: "VERKAUFT", ended: "BEENDET"
            },
            fr: {
                connecting: "Connexion en cours...", connected: "EN LIGNE", error: "Erreur",
                live: "EN DIRECT", currentBid: "OFFRE ACTUELLE", lastBidder: "Dernier", liveFeed: "Flux",
                waitingMessage: "En attente...", bidAction: "a offert",
                signalRError: "SignalR manquant!", placeBidTitle: "Faire une offre", bidButton: "ENVOYER",
                successTitle: "SuccÃ¨s!", successMsg: "Offre placÃ©e.", errorTitle: "Erreur!",
                lowBidMsg: "L'offre doit Ãªtre plus Ã©levÃ©e!", sold: "VENDU", ended: "TERMINÃ‰"
            }
        };

        let currentLang = 'tr';

        function changeLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) el.innerHTML = translations[lang][key];
            });
            if (connection.state === signalR.HubConnectionState.Connected) {
                document.getElementById("statusText").innerText = translations[lang].connected;
            }
            // SatÄ±ldÄ± yazÄ±sÄ±nÄ± da gÃ¼ncelle
            document.querySelector(".sold-text").innerText = translations[lang].sold;
        }

        const statusDot = document.getElementById("connectionStatus");
        const statusText = document.getElementById("statusText");
        const priceEl = document.getElementById("currentPrice");
        const leaderEl = document.getElementById("leaderUser");
        const feedEl = document.getElementById("activityFeed");
        const bidSound = document.getElementById("bidSound");
        const winSound = document.getElementById("winSound");
        const bidAmountInput = document.getElementById("bidAmountInput");

        // --- SIGNALR DÄ°NLEYÄ°CÄ°SÄ° (ROBOT BURAYA VERÄ° ATIYOR) ---
        const connection = new signalR.HubConnectionBuilder()
            .withUrl(`${API_BASE_URL}/auctionHub`)
            .withAutomaticReconnect()
            .build();

        // 1. MÃ¼zayede bitiÅŸ sinyalini burada yakalÄ±yorum
        connection.on("AuctionEnded", (auctionId, winner, finalPrice) => {
            // A) GÃ¶rsel efektleri devreye sokuyorum (SatÄ±ldÄ± DamgasÄ±)
            const overlay = document.getElementById("soldOverlay");
            overlay.classList.remove("d-none");
            overlay.querySelector(".sold-text").innerText = translations[currentLang].sold;

            // B) Paneli kilitliyorum ki iÅŸlem yapÄ±lamasÄ±n
            const panel = document.getElementById("bidPanel");
            panel.style.opacity = "0.3";
            panel.style.pointerEvents = "none";

            // C) Rozetleri gÃ¼ncelliyorum
            const badge = document.getElementById("liveBadge");
            badge.className = "badge bg-secondary position-absolute top-0 start-0 m-3 px-3 py-2 rounded-pill";
            badge.innerHTML = `<i class="fa-solid fa-lock me-1"></i> ${translations[currentLang].ended}`;

            // D) SayacÄ± sÄ±fÄ±rlÄ±yorum
            document.getElementById("countdownTimer").innerText = "00:00:00";
            document.getElementById("countdownTimer").style.color = "#ff3333";

            // E) FiyatÄ± ve KazananÄ± sabitliyorum
            priceEl.innerText = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(finalPrice);
            leaderEl.innerText = winner;

            winSound.play().catch(e => console.log("Ses oynatÄ±lamadÄ±"));

            var duration = 5 * 1000;
            var animationEnd = Date.now() + duration;
            var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 999 };

            var interval = setInterval(function() {
                var timeLeft = animationEnd - Date.now();
                if (timeLeft <= 0) return clearInterval(interval);
                var particleCount = 50 * (timeLeft / duration);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));
            }, 250);

            // G) SweetAlert ile zafer mesajÄ±nÄ± gÃ¶steriyorum
            Swal.fire({
                title: translations[currentLang].ended,
                html: `<div style='font-size: 1.2rem'>${translations[currentLang].lastBidder}: <strong>${winner}</strong></div><div style='font-size: 2rem; color: #00ff88; font-weight: bold'>${finalPrice} $</div>`,
                icon: 'success',
                background: '#050505',
                color: '#fff',
                confirmButtonColor: '#00ff88',
                confirmButtonText: 'Tamam'
            });
        });

        // 2. Normal teklif gelince burasÄ± Ã§alÄ±ÅŸÄ±yor
        connection.on("ReceiveBid", (user, amount) => {
            bidSound.currentTime = 0;
            bidSound.play().catch(e => console.log("Ses hatasÄ±:", e));
            shootConfetti(); // KÄ±sa konfeti

            priceEl.classList.add("price-pop");
            priceEl.style.textShadow = "0 0 30px rgba(0, 255, 136, 0.8)";

            animatePrice(currentDisplayedPrice, amount, 1500);
            currentDisplayedPrice = amount;
            currentRealPrice = amount;

            leaderEl.innerText = user;

            const waitingMsg = document.getElementById("waitingMessageContainer");
            if (waitingMsg) waitingMsg.remove();

            const now = new Date().toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const actionText = translations[currentLang].bidAction;

            const newItem = `
                <div class="bid-item d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle bg-secondary bg-opacity-25 p-2 me-3 text-center" style="width: 40px; height: 40px;">
                            <i class="fa-solid fa-user text-white"></i>
                        </div>
                        <div>
                            <div class="fw-bold text-white" style="font-size: 0.95rem;">${user}</div>
                            <small class="text-secondary" style="font-size: 0.75rem;">${actionText}</small>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="fw-bold text-success">${currencyFormatter.format(amount)}</div>
                        <small class="text-secondary" style="font-size: 0.75rem;">${now}</small>
                    </div>
                </div>
            `;
            feedEl.insertAdjacentHTML('afterbegin', newItem);
        });

        // --- TEKLÄ°F GÃ–NDERME FONKSÄ°YONUM ---
        async function submitBid() {
            const auctionId = document.getElementById("auctionIdInput").value;
            const user = document.getElementById("userInput").value;
            const amount = parseFloat(bidAmountInput.value);

            if (!auctionId || !user || !amount) {
                Swal.fire({ icon: 'warning', title: 'Eksik Bilgi', text: 'LÃ¼tfen ID, Ä°sim ve Tutar girin.', background: '#1a1a1a', color: '#fff' });
                return;
            }

            if (amount <= currentRealPrice) {
                Swal.fire({ icon: 'error', title: translations[currentLang].errorTitle, text: translations[currentLang].lowBidMsg, background: '#1a1a1a', color: '#fff' });
                return;
            }

            try {
                const btn = document.getElementById("submitBtn");
                btn.disabled = true;
                btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';

                const response = await fetch(`${API_BASE_URL}/api/Auctions/${auctionId}/bids?amount=${amount}&userId=${user}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                if (response.ok) {
                    Swal.fire({
                        icon: 'success',
                        title: translations[currentLang].successTitle,
                        text: `${amount} $ - ${translations[currentLang].successMsg}`,
                        background: '#1a1a1a',
                        color: '#fff',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } else {
                    const err = await response.json();
                    Swal.fire({ icon: 'error', title: 'Oops...', text: err.message || 'Hata oluÅŸtu', background: '#1a1a1a', color: '#fff' });
                }
            } catch (error) {
                console.error(error);
                Swal.fire({ icon: 'error', title: 'BaÄŸlantÄ± HatasÄ±', text: 'Backend sunucusuna ulaÅŸÄ±lamadÄ±.', background: '#1a1a1a', color: '#fff' });
            } finally {
                const btn = document.getElementById("submitBtn");
                btn.disabled = false;
                btn.innerHTML = `<span data-i18n="bidButton">${translations[currentLang].bidButton}</span> <i class="fa-solid fa-paper-plane ms-2"></i>`;
            }
        }

        function addQuickBid(val) {
            let base = currentRealPrice > 0 ? currentRealPrice : 500000;
            let currentInputVal = parseFloat(bidAmountInput.value) || base;
            bidAmountInput.value = currentInputVal + val;
        }

        // --- YARDIMCI FONKSÄ°YONLARIM ---
        const currencyFormatter = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });

        function animatePrice(start, end, duration) {
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const currentVal = Math.floor(progress * (end - start) + start);
                priceEl.innerText = currencyFormatter.format(currentVal);
                if (progress < 1) window.requestAnimationFrame(step);
                else {
                    priceEl.innerText = currencyFormatter.format(end);
                    priceEl.style.color = "#fff";
                    priceEl.classList.remove("price-pop");
                }
            };
            window.requestAnimationFrame(step);
        }

        function shootConfetti() {
            var count = 200;
            var defaults = { origin: { y: 0.7 } };
            function fire(particleRatio, opts) {
                confetti(Object.assign({}, defaults, opts, { particleCount: Math.floor(count * particleRatio) }));
            }
            fire(0.25, { spread: 26, startVelocity: 55, });
            fire(0.2, { spread: 60, });
            fire(0.35, { spread: 100, decay: 0.91, scalar: 0.8 });
            fire(0.1, { spread: 120, startVelocity: 25, decay: 0.92, scalar: 1.2 });
            fire(0.1, { spread: 120, startVelocity: 45, });
        }

        function startCountdown(duration) {
            let timer = duration, hours, minutes, seconds;
            setInterval(function () {
                hours = parseInt(timer / 3600, 10);
                minutes = parseInt((timer % 3600) / 60, 10);
                seconds = parseInt(timer % 60, 10);
                hours = hours < 10 ? "0" + hours : hours;
                minutes = minutes < 10 ? "0" + minutes : minutes;
                seconds = seconds < 10 ? "0" + seconds : seconds;
                document.getElementById("countdownTimer").innerHTML = `<i class="fa-regular fa-clock me-2"></i>${hours}:${minutes}:${seconds}`;
                if (--timer < 0) timer = 0;
            }, 1000);
        }
        startCountdown(5 * 60 * 60);

        if (typeof signalR === 'undefined') {
            statusText.innerText = "SignalR HatasÄ±!";
            statusText.className = "small fw-bold text-danger";
            throw new Error("SignalR yÃ¼klenemedi.");
        }

        async function start() {
            try {
                await connection.start();
                statusDot.style.color = "#00ff88";
                statusDot.style.textShadow = "0 0 10px #00ff88";
                statusText.innerText = translations[currentLang].connected;
                statusText.className = "small fw-bold text-success";
            } catch (err) {
                statusDot.style.color = "#dc3545";
                statusText.innerText = translations[currentLang].error;
                statusText.className = "small fw-bold text-danger";
            }
        }
        start();
    </script>
</body>
</html>